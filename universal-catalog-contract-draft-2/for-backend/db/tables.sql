/*
Tables:
CARD_PRODUCTS_V1
CARD_PRODUCTS_V1_TEXTS
TAGS
TAG_RELATIONS
PRODUCT_ISSUE_BRANCHES
PRODUCT_ISSUE_BRANCHES_META
CARD_ISSUE_BRANCHES
CARD_ISSUE_BRANCHES_DELIVERY
MAPS
CARD_ISSUES
CARD_ISSUE_DELIVERY

Disclaimer:
Убедительная просьба проверить корректность.
*/

CREATE TABLE CARD_PRODUCTS_V1 (
    ID                       NUMBER(10) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL,
    PRODUCT_CODE             VARCHAR(50) NULL, /** 870, 860, 840, ... */
    COMMISSION               VARCHAR(50) NULL, /** IDENTIFICATOR COMMISSION FOR ISSUE CARD */
    HAS_CUSTOM_DESIGN        NUMBER(1) DEFAULT 0 NOT NULL, /** 0|1 */
    CUSTOM_DESIGN_COMMISSION VARCHAR(50) NULL, /** IDENTIFICATOR COMMISSION FOR ISSUE CARD */
    CUSTOM_DESIGN_CODE       VARCHAR(50) NULL, /** CUSTOM DESIGN CODE: 036, 037, ... */
    STATE                    NUMBER(1) DEFAULT 0 NOT NULL, /** 0|1|2 */
    BACKGROUND               VARCHAR(250) NULL, /** image url */
    LOGOS_LAYER              VARCHAR(250) NULL, /** image url */
    WEBVIEW                  VARCHAR(250) NULL, /** webview url */
    EMBOSS_TYPE              VARCHAR(50) NOT NULL, /** uzcard|humo|tieto */
    IS_VIRTUAL               NUMBER(1) DEFAULT 0 NOT NULL, /** 0|1 */
    TYPE_APPLICATION         VARCHAR(50) NOT NULL, /** uzcard_issue, humo_issue, humovirtual, visa_issue */
    SORT_ORDER               NUMBER(10) DEFAULT 100 NOT NULL, /** sort order ascending order */
    CURRENCY                 VARCHAR(50) DEFAULT 'UZS' NOT NULL, /** Card currency */
    PRICE                    VARCHAR(250) NOT NULL, /** card price in cents */
    CARD_IMAGE               VARCHAR(250) NOT NULL, /** card image url */
    BACKGROUND_COLOR         VARCHAR(250) NOT NULL, /** card background color of card (page_background_color) */
    HEADER_COLOR             CLOB NULL, /** card background color of card (widget) */
    CREATED_AT               TIMESTAMP DEFAULT SYSDATE,
    UPDATED_AT               TIMESTAMP DEFAULT SYSDATE,
    DELETED_AT               TIMESTAMP NULL,
    CONSTRAINT CARD_PRODUCTS_V1_PK PRIMARY KEY (ID)
);
CREATE TABLE CARD_PRODUCTS_V1_TEXTS (
    ID                       NUMBER(10) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL,
    CARD_PRODUCT_ID          NUMBER(10) NOT NULL, /** Foreign key from table card_products_v1 id */
    LANGUAGE                 VARCHAR(3) NOT NULL, /** uz|ru|en */
    TITLE                    VARCHAR(250) NOT NULL, /** title of the product - */
    DESCRIPTION              CLOB NOT NULL, /** description of product - */
    ICON_ID                  VARCHAR(250), /** FK - ICONS.ID */
    TYPE                     VARCHAR(250) NOT NULL, /** collapse, text, etc. */
    SORT_ORDER               NUMBER(10) DEFAULT 100 NOT NULL,
    RENDER_ID                VARCHAR(250) NULL, /** FK - LAYOUT_RENDERS.ID */
    ACTION_ID                VARCHAR(250) NULL, /** FK - LAYOUT_ACTIONS.ID */
    CREATED_AT               TIMESTAMP DEFAULT SYSDATE,
    UPDATED_AT               TIMESTAMP DEFAULT SYSDATE,
    DELETED_AT               TIMESTAMP NULL,
    CONSTRAINT CARD_PRODUCTS_V1_TEXTS_PK PRIMARY KEY (ID)
);
CREATE TABLE TAGS (
    ID                       NUMBER(10) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL,
    NAME                     VARCHAR(250) NOT NULL,
    TYPE                     VARCHAR(50) NOT NULL,
    "GROUP"                  VARCHAR(50) NULL,
    SORT_ORDER               NUMBER(10) DEFAULT 100 NOT NULL,
    IS_PRIMARY               NUMBER(1) DEFAULT 0 NOT NULL, /** 0|1 */
    STATE                    NUMBER(1) DEFAULT 0 NOT NULL,
    CREATED_AT               TIMESTAMP DEFAULT SYSDATE,
    UPDATED_AT               TIMESTAMP DEFAULT SYSDATE,
    DELETED_AT               TIMESTAMP NULL,
    CONSTRAINT TAGS_PK PRIMARY KEY (ID)
);
CREATE TABLE TAG_RELATIONS (
    ID                       NUMBER(10) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL,
    TAG_ID                   NUMBER(10) NOT NULL,
    TARGET_ID                NUMBER(10) NOT NULL,
    TARGET                   VARCHAR(250) NOT NULL,
    RENDER_ID                VARCHAR(250) NULL, /** FK - LAYOUT_RENDERS.ID */
    CREATED_AT               TIMESTAMP DEFAULT SYSDATE,
    UPDATED_AT               TIMESTAMP DEFAULT SYSDATE,
    CONSTRAINT TAG_RELATIONS_PK PRIMARY KEY (ID)
);
CREATE INDEX TAG_RELATIONS_IDX_TARGET ON TAG_RELATIONS (TARGET, TARGET_ID);
CREATE INDEX TAG_RELATIONS_IDX_TAG ON TAG_RELATIONS (TAG_ID);

ALTER TABLE INDESIGN_TEMPLATES
    ADD USER_ID NUMBER(10) NULL;
ALTER TABLE INDESIGN_TEMPLATES
    ADD STATE VARCHAR(250) DEFAULT 'approved';

CREATE TABLE PRODUCT_ISSUE_BRANCHES (
    ID                       NUMBER(10) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL,
    PARENT_ID                NUMBER(10) NULL, /** FK - PRODUCT_ISSUE_BRANCHES.ID */
    BUSINESS_ID              VARCHAR(50) NOT NULL, /** BUSINESS BRANCHES: 00444, 00421,... */
    LATITUDE                 VARCHAR(50) NULL,
    LONGITUDE                VARCHAR(50) NULL,
    CREATED_AT               TIMESTAMP DEFAULT SYSDATE,
    UPDATED_AT               TIMESTAMP DEFAULT SYSDATE,
    DELETED_AT               TIMESTAMP NULL,
    CONSTRAINT PRODUCT_ISSUE_BRANCHES PRIMARY KEY (ID)
);

CREATE TABLE PRODUCT_ISSUE_BRANCHES_META (
    -- 
    ID                       NUMBER(10) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL,
    BRANCH_ID                NUMBER(10) NULL, /** FK - PRODUCT_ISSUE_BRANCHES.ID */
    LANGUAGE                 VARCHAR(50) DEFAULT 'ru' NOT NULL, /** uz|ru|en */
    TITLE                    VARCHAR(250) NULL, /** Название филиала */
    DESCRIPTION              CLOB NULL,
    ADDRESS                  VARCHAR(250) NULL,
    SHORT_ADDRESS            VARCHAR(250) NULL,
    WEEK_DAYS                CLOB NULL,
    OPENING_HOURS            VARCHAR(100) NULL,
    LUNCH_HOURS              VARCHAR(100) NULL,
    CREATED_AT               TIMESTAMP DEFAULT SYSDATE,
    UPDATED_AT               TIMESTAMP DEFAULT SYSDATE,
    DELETED_AT               TIMESTAMP NULL,
    CONSTRAINT PRODUCT_ISSUE_BRANCHES_META PRIMARY KEY (ID)
);

CREATE TABLE CARD_ISSUE_BRANCHES (
    ID                       NUMBER(10) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL,
    BRANCH_ID                NUMBER(10) NULL, /** FK - PRODUCT_ISSUE_BRANCHES.ID */
    TIETO_EMBOSS_ID          VARCHAR(250) NULL, /** tieto_branch identificator embosser tieto */
    IS_TIETO_EMBOSS_ACTIVE   NUMBER(1) DEFAULT 0 NOT NULL, /** 0|1 */
    HUMO_EMBOSS_ID           VARCHAR(50) NULL, /** identificator embosser humo */
    IS_HUMO_EMBOSS_ACTIVE    NUMBER(1) DEFAULT 0 NOT NULL, /** 0|1 */
    UZCARD_EMBOSS_ID         VARCHAR(50) NULL, /** identificator embosser uzcard */
    IS_UZCARD_EMBOSS_ACTIVE  NUMBER(1) DEFAULT 0 NOT NULL, /** 0|1 */
    STATE                    NUMBER(1) DEFAULT 0 NOT NULL, /** 0|1 - Активен или неактивен на выпуск */
    CREATED_AT               TIMESTAMP DEFAULT SYSDATE,
    UPDATED_AT               TIMESTAMP DEFAULT SYSDATE,
    DELETED_AT               TIMESTAMP NULL,
    CONSTRAINT CARD_ISSUE_BRANCHES PRIMARY KEY (ID)
);

CREATE TABLE CARD_ISSUE_BRANCHES_DELIVERY (
    ID                       NUMBER(10) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL,
    BRANCH_ID                NUMBER(10) NULL, /** FK - CARD_ISSUE_BRANCHES.ID */
    GEO_JSON                 CLOB NULL, /** KML polygon - [[lat,lot], [lat,lon], ...] */
    COMMISSION               VARCHAR(50) NULL, /** COMMISSION FOR DELIVERY. UNKNOWN */
    STATE                    NUMBER(1) DEFAULT 0 NOT NULL, /** 0|1 - Активна ли сейчас зона */
    CREATED_AT               TIMESTAMP DEFAULT SYSDATE,
    UPDATED_AT               TIMESTAMP DEFAULT SYSDATE,
    DELETED_AT               TIMESTAMP NULL,
    CONSTRAINT CARD_ISSUE_BRANCHES_DELIVERY PRIMARY KEY (ID)
);

CREATE TABLE MAPS (
    ID                       NUMBER(10) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL,
    KEY                      VARCHAR2(255) NOT NULL,
    TYPE                     VARCHAR(250) DEFAULT 'google' NULL,
    URL                      VARCHAR(250) NULL,
    STATE                    NUMBER(1) DEFAULT 0 NOT NULL, /** 0|1 - Активна или неактивна карта */
    CREATED_AT               TIMESTAMP DEFAULT SYSDATE,
    UPDATED_AT               TIMESTAMP DEFAULT SYSDATE,
    DELETED_AT               TIMESTAMP NULL,
    CONSTRAINT MAPS PRIMARY KEY (ID)
);

CREATE TABLE CARD_ISSUES (
    ID                       NUMBER(10) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL,
    USER_ID                  NUMBER(10) NOT NULL, /** FK - USERS.ID */
    CARD_PRODUCT_ID          NUMBER(10) NOT NULL, /** FK - CARD_PRODUCTS_V1.ID */
    INDESIGN_TEMPLATE_ID     NUMBER(10) NULL, /** FK - INDESIGN_TEMPLATES.ID */
    CARD_ISSUE_DELIVERY_ID   NUMBER(10) NULL, /** FK - CARD_ISSUE_DELIVERY.ID */
    CARD_ISSUE_BRANCH_ID     NUMBER(10) NULL, /** FK - CARD_ISSUE_BRANCH.ID */
    STATE                    VARCHAR(50) DEFAULT 'draft' NOT NULL,
    CUSTOMER                 VARCHAR(50) NOT NULL,
    BRANCH                   VARCHAR(50) NOT NULL,
    CARD_PRODUCT_CODE        VARCHAR(50) NOT NULL, /** CARD_PRODUCTS_V1 PRODUCT_CODE OR CUSTOM_DESIGN_CODE */
    TARGET_MFO               VARCHAR(50) NOT NULL,
    ABS_APP_ID               VARCHAR(50) DEFAULT 0 NULL,
    TYPE                     VARCHAR(50) NOT NULL,
    ADDITIONAL               CLOB NULL,
    ACCEPTED_AT              TIMESTAMP NULL,
    CREATED_AT               TIMESTAMP DEFAULT SYSDATE,
    UPDATED_AT               TIMESTAMP DEFAULT SYSDATE,
    DELETED_AT               TIMESTAMP NULL,
    CONSTRAINT CARD_ISSUES PRIMARY KEY (ID)
);

CREATE TABLE CARD_ISSUE_DELIVERY (
    ID                       NUMBER(10) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL,
    LATITUDE                 VARCHAR(50) NULL,
    LONGITUDE                VARCHAR(50) NULL,
    ADDRESS                  VARCHAR(250) NULL,
    COMMENT                  VARCHAR(250) NULL,
    PHONE                    VARCHAR(12) NULL,
    STATE                    VARCHAR(250) DEFAULT 'draft' NOT NULL, /** draft, ... */
    CREATED_AT               TIMESTAMP DEFAULT SYSDATE,
    UPDATED_AT               TIMESTAMP DEFAULT SYSDATE,
    DELETED_AT               TIMESTAMP NULL,
    CONSTRAINT CARD_ISSUE_DELIVERY PRIMARY KEY (ID)
);
